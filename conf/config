-------------------------
-       SONARQUBE       -
-------------------------

cd /Users/alberto/Developer/temperatus/
mysql.server start
sonar start
sonar-runner

user: admin
pass: admin

-------------------------
-       DATABASE        -
-------------------------

name: database.h2.db
user: aquesada
pass: temperatus2015


DROP TABLE IF EXISTS PROJECT;
CREATE TABLE PROJECT(
    ID INT AUTO_INCREMENT,
    NAME VARCHAR(100) UNIQUE NOT NULL,
    DATE_INI DATE NOT NULL,
    OBSERVATIONS CLOB,

    PRIMARY KEY(ID) );

DROP TABLE IF EXISTS SUBJECT;
CREATE TABLE SUBJECT (
    ID INT AUTO_INCREMENT,
    IS_PERSON BOOLEAN NOT NULL,
    NAME VARCHAR(300) UNIQUE NOT NULL,
    SEX BOOLEAN,
    AGE INT,
    WEIGHT DOUBLE,
    HEIGHT DOUBLE,
    OBSERVATIONS CLOB,

    PRIMARY KEY(ID) );

DROP TABLE IF EXISTS GAME;
CREATE TABLE GAME (
    ID INT AUTO_INCREMENT,
    TITLE VARCHAR(100) UNIQUE NOT NULL,
    NUM_BUTTONS INT NOT NULL,
    OBSERVATIONS CLOB,

    PRIMARY KEY(ID) );

DROP TABLE IF EXISTS AUTHOR;
CREATE TABLE AUTHOR (
    ID INT AUTO_INCREMENT,
    NAME VARCHAR(100) UNIQUE NOT NULL,

    PRIMARY KEY(ID));

DROP TABLE IF EXISTS MISSION;
CREATE TABLE MISSION (
    ID INT AUTO_INCREMENT,
    NAME VARCHAR(100) UNIQUE NOT NULL,
    AUTHOR_ID INT NOT NULL,
    DATE_INI DATE NOT NULL,
    OBSERVATIONS CLOB,
    PROJECT_ID INT NOT NULL,
    GAME_ID INT NOT NULL,
    SUBJECT_ID INT NOT NULL,

    PRIMARY KEY(ID),
    CONSTRAINT FK_M_G_ID FOREIGN KEY(GAME_ID) REFERENCES GAME(ID) ON DELETE CASCADE,
    CONSTRAINT FK_M_S_ID FOREIGN KEY(SUBJECT_ID) REFERENCES SUBJECT(ID) ON DELETE CASCADE,
    CONSTRAINT FK_M_A_ID FOREIGN KEY(AUTHOR_ID) REFERENCES AUTHOR(ID) ON DELETE CASCADE,
    CONSTRAINT FK_M_P_ID FOREIGN KEY(PROJECT_ID) REFERENCES PROJECT(ID) ON DELETE CASCADE);

DROP TABLE IF EXISTS POSITION;
CREATE TABLE POSITION (
    ID INT AUTO_INCREMENT,
    PLACE VARCHAR(100) UNIQUE NOT NULL,
    PICTURE VARCHAR(200),

    PRIMARY KEY(ID) );

DROP TABLE IF EXISTS GAME_POSITION;
CREATE TABLE GAME_POSITION (
    GAME_ID INT NOT NULL,
    POSITION_ID INT NOT NULL,

    PRIMARY KEY(GAME_ID, POSITION_ID),
    CONSTRAINT FK_GP_G_ID FOREIGN KEY(GAME_ID) REFERENCES GAME(ID) ON DELETE CASCADE,
    CONSTRAINT FK_GP_P_ID FOREIGN KEY(POSITION_ID) REFERENCES POSITION(ID) ON DELETE CASCADE);

DROP TABLE IF EXISTS IBUTTON;
CREATE TABLE IBUTTON (
    ID INT AUTO_INCREMENT,
    SERIAL VARCHAR(200) UNIQUE NOT NULL,
    MODEL VARCHAR(200) NOT NULL,
    DEFAULTPOS INT,
    ALIAS VARCHAR(30) UNIQUE,

    PRIMARY KEY(ID),
    CONSTRAINT FK_IB_P_ID FOREIGN KEY(DEFAULTPOS) REFERENCES POSITION(ID) ON DELETE CASCADE);

DROP TABLE IF EXISTS RECORD;
CREATE TABLE RECORD (
    ID INT AUTO_INCREMENT,
    MISSION_ID INT NOT NULL,
    IBUTTON_ID INT NOT NULL,
    POSITION_ID INT NOT NULL,

    PRIMARY KEY(ID),
    CONSTRAINT FK_B_M_ID FOREIGN KEY(MISSION_ID) REFERENCES MISSION(ID) ON DELETE CASCADE,
    CONSTRAINT FK_B_IB_ID FOREIGN KEY(IBUTTON_ID) REFERENCES IBUTTON(ID) ON DELETE CASCADE,
    CONSTRAINT FK_B_P_ID FOREIGN KEY(POSITION_ID) REFERENCES POSITION(ID) ON DELETE CASCADE);

DROP TABLE IF EXISTS MEASUREMENT;
CREATE TABLE MEASUREMENT (
    ID BIGINT AUTO_INCREMENT,
    RECORD_ID INT NOT NULL,
    DATE TIMESTAMP NOT NULL,
    DATA DOUBLE NOT NULL,
    UNIT INT NOT NULL,

    PRIMARY KEY(ID),
    CONSTRAINT FK_D_B_ID FOREIGN KEY(RECORD_ID) REFERENCES RECORD(ID) ON DELETE CASCADE);

CREATE INDEX RECORD_INDEX ON MEASUREMENT(RECORD_ID);

DROP TABLE IF EXISTS FORMULA;
CREATE TABLE FORMULA (
    ID INT AUTO_INCREMENT,
    NAME VARCHAR(50) NOT NULL UNIQUE,
    DESCRIPTION VARCHAR(200),
    REFERENCE VARCHAR(200),
    OPERATION VARCHAR(200) NOT NULL,

    PRIMARY KEY(ID));

DROP TABLE IF EXISTS GAME_FORMULA;
CREATE TABLE GAME_FORMULA (
    GAME_ID INT NOT NULL,
    FORMULA_ID INT NOT NULL,

    PRIMARY KEY(GAME_ID, FORMULA_ID),
    CONSTRAINT FK_GF_G_ID FOREIGN KEY(GAME_ID) REFERENCES GAME(ID) ON DELETE CASCADE,
    CONSTRAINT FK_GF_F_ID FOREIGN KEY(FORMULA_ID) REFERENCES FORMULA(ID) ON DELETE CASCADE);

INSERT INTO GAME VALUES(1, 'GAME12', 12, 'NO OBSERVATIONS');
INSERT INTO POSITION VALUES(1, 'SHOULDER', NULL);
INSERT INTO GAME_POSITION VALUES(1, 1);
INSERT INTO IBUTTON VALUES(1, 'WSA123455ASD', 'DSL993L', 1, 'boton 1');
INSERT INTO PROJECT VALUES(1, 'PROJECT 1', '2016-02-02', 'NO OBSERVATIONS');
INSERT INTO SUBJECT VALUES(1, TRUE, 'ISABEL', TRUE, 23, 56, 170, 'NO OBSERVATIONS');
INSERT INTO AUTHOR VALUES(1, 'ALBERTO QUESADA');
INSERT INTO MISSION VALUES (1,'MISSION 1', 1, '2016-02-03', 'NO OBSERVATIONS', 1, 1, 1);
INSERT INTO RECORD VALUES(1,1,1,1);
INSERT INTO FORMULA VALUES(1, 'FORMULA 1', 'NO DESCRIPTION', 'NO REFERENCE', 'A+B+C');
INSERT INTO GAME_FORMULA VALUES(1, 1);
INSERT INTO MEASUREMENT VALUES(1, 1, '2016-02-01 20:20:00', 18.2, 0);
INSERT INTO MEASUREMENT VALUES(2, 1, '2016-02-01 20:21:00', 19.1, 0);
INSERT INTO MEASUREMENT VALUES(3, 1, '2016-02-01 20:22:00', 20.1, 0);
INSERT INTO MEASUREMENT VALUES(4, 1, '2016-02-01 20:23:00', '19', 0);





-------------------------
-                       -
-------------------------



